// Sample config for Alloy.
//
// For a full configuration reference, see https://grafana.com/docs/alloy
logging {
  level = "warn"
}

loki.write "k8s" {
  endpoint {
    url = "http://loki.o11y.svc.cluster.local:3100/loki/api/v1/push"
  }
}

prometheus.remote_write "alloy" {
  endpoint {
    url = "http://mimir-victoria-metrics-single-server.o11y.svc.cluster.local:8428/prometheus/api/v1/write"
  }
}

prometheus.exporter.unix "default" {
  include_exporter_metrics = true
  disable_collectors       = ["mdadm"]
}

prometheus.scrape "default" {
  targets = array.concat(
    prometheus.exporter.unix.default.targets,
    [{
      // Self-collect metrics
      job         = "alloy",
      __address__ = "127.0.0.1:12345",
    }],
  )

  forward_to = [ prometheus.remote_write.alloy.receiver ]
}
